# Полезные команды или фишки OpenWrt

### 1. Заворачиваем весь трафик на конкретном устройстве через PBR по SSH

Перед этим необходимо чтобы OWRT уже была установлена и настроена, а также установлены основные протоколы (например WG,AWG,OVPN) и настроены зоны в Firewall. Ну и конечно же, установлена сама PBR.
```
var shell = new SSH().host("X.X.X.X").username("username").password("password").connect() - объявляем переменную, которая будет подключаться по SSH к серверу.
shell.execute("uci set pbr.@policy[X].enabled='1'") - в объявленной переменной после подключения исполняем команду, которая включит необходимую политику.
shell.execute("uci commit pbr") - исполняем команду, которая применит изменения в PBR
shell.execute("/etc/init.d/pbr restart") - рестартим PBR
```

X.X.X.X - ip адрес роутера

username - имя пользователя OWRT/SSH

password - пароль пользователя OWRT/SSH

@policy[X], где X - это номер политики созданной в PBR. 

P.S отсчет номеров политик идет именно от 0 (т.к это массив,а в массиве индекс элементов начинается с 0), то есть, если у вас настроены 4 политики, то 1-ая политика будет под номером 0, вторая под номером 1 и т.д.

Данный пример реализован в системе умного дома Spruthub. Я не думаю, что общая картина взаимодействия по SSH от этого как-то поменяется ибо все плюс минус одинаково, главное понять что куда и как. 
